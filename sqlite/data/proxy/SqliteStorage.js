function _7eb3df21df149ce98264097975d533c22a4ee04b(){};Ext.define("Sqlite.data.proxy.SqliteStorage",{extend:"Ext.data.proxy.Client",alias:"proxy.sqlitestorage",config:{reader:null,writer:null,dbConfig:null},constructor:function(a){this.callParent([a]);this.setReader(this.reader);var b=this;b.setTable()},create:function(b,h,e){var g=this;var a=b.getRecords(),f=a.length,d,c=[];onSuccess=function(){b.setCompleted();b.setSuccessful();if(typeof h=="function"){h.call(e,b)}},onError=function(j,k){b.setCompleted();b.setException(k?k:"");if(typeof h=="function"){h.call(e,b)}};b.setStarted();if(Ext.isDefined(b.config.fullRewrite)&&b.config.fullRewrite){c.push(function(j){j.executeSql("DELETE FROM "+g.getDbConfig().tablename,[])})}for(d=0;d<f;d++){c.push(this.getInsertRecordFunc(a[d],g.getDbConfig().tablename))}g.transactionDB(g.getDb(),c,onSuccess,onError)},update:function(b,h,e){var g=this;var a=b.getRecords(),f=a.length,d,c=[];onSuccess=function(){b.setCompleted();b.setSuccessful();if(typeof h=="function"){h.call(e,b)}},onError=function(j,k){b.setCompleted();b.setException(k?k:"");if(typeof h=="function"){h.call(e,b)}};b.setStarted();for(d=0;d<f;d++){c.push(this.getUpdateRecordFunc(a[d],g.getDbConfig().tablename))}g.transactionDB(g.getDb(),c,onSuccess,onError)},destroy:function(b,h,e){var g=this;var a=b.getRecords(),f=a.length,d,c=[];onSuccess=function(){b.setCompleted();b.setSuccessful();if(typeof h=="function"){h.call(e,b)}},onError=function(j,k){b.setCompleted();b.setException(k?k:"");if(typeof h=="function"){h.call(e,b)}};b.setStarted();for(d=0;d<f;d++){c.push(this.getDeleteRecordFunc(a[d],g.getDbConfig().tablename))}g.transactionDB(g.getDb(),c,onSuccess,onError)},truncate:function(a){var b=this;var c="DELETE FROM "+b.getDbConfig().tablename;b.transactionDB(b.getDb(),[function(d){d.executeSql(c,[],Ext.emptyFn,Ext.emptyFn)}],Ext.emptyFn,Ext.emptyFn);return true},read:function(d,l,m){var j=this,e=d.getLimit(),b=d.getStart(),a=d.getGrouper(),h=d.getSorters(),c=d.getFilters(),k={};a=this.applyGrouper(a);c=this.applyFilters(c);h=this.applySorters(h);var n="SELECT _ROWID_,*\nFROM "+j.getDbConfig().tablename;if(c!=null){n+=j.whereClause(c)}if(a!=null){n+=j.groupClause(a)}if(h!=null){n+=j.orderClause(h)}if(e!=null&&b!=null){n+=j.limitClause(e,b)}var g,f;g=function(o,p){j.applyDataToModel(o,p,d,l,m)};f=function(o,p){j.throwDbError(o,p)};j.transactionDB(j.getDb(),[function(o){o.executeSql(n,[],g,f)}],Ext.emptyFn,Ext.emptyFn)},getDb:function(){return this.getDbConfig().dbConn.dbConn},throwDbError:function(a,c){var b=this;console.log(this.type+"----"+c.message)},setTable:function(){var c=this,b=function(f,g){c.throwDbError(f,g)},e=function(f){f.executeSql("CREATE TABLE IF NOT EXISTS "+c.getDbConfig().tablename+"("+c.constructFields()+")",[],Ext.emptyFn,b)},d=function(f){f.executeSql("SELECT * FROM "+c.getDbConfig().tablename+" LIMIT 1",[],function(h,g){if(g.rows.length==0){h.executeSql("DROP TABLE IF EXISTS "+c.getDbConfig().tablename,[],e,b)}else{a(h,g.rows.item(0))}},b)},a=function(g,k){var f=Ext.Object.getKeys(k),j=c.getDbFields(),h=[];Ext.each(j,function(l){h.push(l.name)},this);Ext.each(Ext.Array.difference(h,f),function(m){var l=null;Ext.each(j,function(n){if(n.name==m){l=n;return false}},this);g.executeSql("ALTER TABLE "+c.getDbConfig().tablename+" ADD COLUMN "+c.getFieldDefinition(l),[],function(n){if(Ext.isEmpty(l.field.getDefaultValue())){return}n.executeSql("UPDATE "+c.getDbConfig().tablename+" SET "+l.name+" = ?",[l.field.getDefaultValue()],Ext.emptyFn,Ext.emptyFn)},Ext.emptyFn)},this)};c.transactionDB(c.getDb(),[function(f){f.executeSql("SELECT sql FROM sqlite_master WHERE name=?",[c.getDbConfig().tablename],function(h,g){if(g.rows.length>0){d(h)}else{e(h)}},b)}],Ext.emptyFn,Ext.emptyFn)},dropTable:function(a){var b=this;b.getDb().transaction(function(c){var e=function(g,h){b.throwDbError(g,h)};var f=function(g,h){};var d="DROP TABLE "+b.getDbConfig().tablename;c.executeSql(d,[],f,e)})},getDbFields:function(){var d=this,c=d.getModel(),b=c.getFields().items,a=[];Ext.each(b,function(j){if((j.config.persist||!Ext.isDefined(j.config.persist))&&(j.getName()!=c.getIdProperty())){var e=j.getName(),h=j.config.type,g=(j.config.fieldOption)?j.config.fieldOption:"";h=h.replace(/int/i,"INTEGER").replace(/float/i,"FLOAT").replace(/string/i,"TEXT").replace(/array/i,"TEXT").replace(/object/i,"TEXT").replace(/date/i,"DATETIME");a.push({name:e,type:h,option:g,field:j})}});return a},getFieldDefinition:function(a){var b=a.name+" "+a.type;if(!Ext.isEmpty(a.option)){b+=" "+a.option}return b},constructFields:function(){var c=this,a=c.getDbFields(),b=[];Ext.each(a,function(d){b.push(c.getFieldDefinition(d))});return b.join(", ")},getRecordDbObject:function(b){var d=this,a=d.getDbFields(),c={};Ext.each(a,function(g){if(Ext.isDefined(b.get(g.name))){var e=b.get(g.name);if(g.field.getType().type.toUpperCase()=="AUTO"){e=Ext.encode(e)}c[g.name]=e}});return c},transactionDB:function(d,b,f,a,e){var c=this;d.transaction(function(g){if(typeof e=="function"){e.call(scope||c,results,c)}Ext.each(b,function(h){h(g)})},a,f)},whereClause:function(c){var b=this,d=true,e="",a={};Ext.each(b.getDbFields(),function(g){a[g.name]=g.type});Ext.each(c,function(g){if(!Ext.isDefined(a[g.getProperty()])){return}if(!d){e+="\n  AND"}else{e+="\nWHERE\n     "}d=false;e+=" `"+g.getProperty()+"`";var f=a[g.getProperty()].toUpperCase();if(typeof g.getFilterFn()=="string"){e+=" "+g.getFilterFn()}else{if(f=="TEXT"&&!g.getCaseSensitive()){e+=" LIKE"}else{e+=" ="}}if(!g.getExactMatch()&&f=="TEXT"){e+=" '%"+g.getValue()+"%'"}else{if(f=="TEXT"){e+=" '"+g.getValue()+"'"}else{if(f=="boolean"){if(g.getValue()){e+=" 'true'"}else{e+=" 'false'"}}else{e+=" "+g.getValue()}}}});return e},orderClause:function(d){var c=this,f="",b=[],a={},e=true;Ext.each(c.getDbFields(),function(g){a[g.name]=true});Ext.each(d,function(g){if(!Ext.isDefined(a[g.getProperty()])){return}if(g.getRoot()!=null){return}if(g.getDirection()!="ASC"&&g.getDirection()!="DESC"){return}if(!e){f+=",\n  "}else{f+="\nORDER BY\n  "}e=false;f+="`"+g.getProperty()+"` "+g.getDirection()});return f},groupClause:function(b){var d=this,e="",a={},c=true;Ext.each(d.getDbFields(),function(g){a[g.name]=true});Ext.each(b,function(f){if(!Ext.isDefined(a[f.getProperty()])){return}if(f.getRoot()!=null){return}if(!c){e+=",\n  "}else{e+="\nGROUP BY\n  "}c=false;e+="`"+f.getProperty()+"`"});return e},limitClause:function(a,c){var b="\nLIMIT";if(c!=null){b+=" "+c+","}if(a!=null){b+=" "+a}return b},parseData:function(a,b){var e=b.rows,d=[],c=0;for(;c<e.length;c++){d.push(e.item(c))}return d},applyData:function(d,a,e,b){var c=this;a.setSuccessful();a.setCompleted();a.setResultSet(Ext.create("Ext.data.ResultSet",{records:d,total:d.length,loaded:true}));a.setRecords(d);if(typeof e=="function"){e.call(b||c,a)}},applyDataToModel:function(f,e,d,l,m){var j=this,c=j.getModel(),h=c.getFields().items;var b=j.parseData(f,e);var k=[];if(e.rows&&b.length){for(i=0;i<e.rows.length;i++){var a=b[i].rowid;var g={};Ext.each(h,function(n){if(n.getType().type.toUpperCase()=="AUTO"){g[n.getName()]=Ext.decode(Ext.isDefined(b[i][n.getName()])?b[i][n.getName()]:null)}else{g[n.getName()]=Ext.isDefined(b[i][n.getName()])?b[i][n.getName()]:null}});k.push(new c(g,a))}}j.applyData(k,d,l,m)},getInsertRecordFunc:function(e,d){var h=this,a=h.getRecordDbObject(e),f=[],k=[],j=[],g=function(m,n){var o=n.insertId;if(e.phantom){e.phantom=false}e.setId(o)},c=function(m,n){h.throwDbError(m,n)};for(var b in a){f.push(b);k.push(a[b]);j.push("?")}var l="INSERT INTO "+d+"("+f.join(",")+") VALUES ("+j.join(",")+")";return function(m){m.executeSql(l,k,g,c)}},getUpdateRecordFunc:function(f,e){var h=this,a=f.getId(),l=h.getRecordDbObject(f),b=[],j=[],g=function(m,n){if(n.rowsAffected==0){h.getInsertRecordFunc(f,e)(m)}},d=function(m,n){h.throwDbError(m,n)};for(var c in l){b.push(c+" = ?");j.push(l[c])}j.push(f.getId());var k="UPDATE "+e+" SET "+b.join(",")+" WHERE _ROWID_ = ?";return function(m){m.executeSql(k,j,g,d)}},getDeleteRecordFunc:function(a,c){var e=this,b=[],g=function(h,j){},d=function(h,j){e.throwDbError(h,j)};var f="DELETE FROM "+c+" WHERE _ROWID_ = ?";b.push(a.getId());return function(h){h.executeSql(f,b,g,d)}},applyGrouper:function(a){var b=[];if(a){if(!Ext.isArray(a)){a=[a]}Ext.each(a,function(c){if(typeof c=="string"){c={property:c}}b.push(Ext.factory(c,Ext.util.Grouper))})}return b},applyFilters:function(b){var a=[];if(b){if(!Ext.isArray(b)){b=[b]}Ext.each(b,function(c){a.push(Ext.factory(c,Ext.util.Filter))})}return a},applySorters:function(b){var a=[];if(b){if(!Ext.isArray(b)){b=[b]}Ext.each(b,function(c){a.push(Ext.factory(c,Ext.util.Sorter))})}return a}});